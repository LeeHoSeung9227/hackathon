<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ± Hackathon í†µí•© ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            font-size: 1.4rem;
        }
        
        .user-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .user-selector label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .user-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .loading {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .ranking-list {
            max-height: 250px;
            overflow-y: auto;
        }
        
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .ranking-position {
            font-weight: bold;
            color: #667eea;
            min-width: 30px;
        }
        
        .ranking-name {
            flex: 1;
            margin-left: 10px;
        }
        
        .ranking-points {
            font-weight: bold;
            color: #28a745;
        }
        
        .level-progress {
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .ai-results {
            margin: 10px 0;
        }
        
        .ai-item {
            padding: 10px;
            margin: 5px 0;
            background: #e8f5e8;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .point-history {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .point-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin: 3px 0;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .point-earned {
            color: #28a745;
            font-weight: bold;
        }
        
        .point-spent {
            color: #dc3545;
            font-weight: bold;
        }
        
        .refresh-all {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
        }
        
        .refresh-all:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(40, 167, 69, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ± Hackathon í†µí•© ëŒ€ì‹œë³´ë“œ</h1>
            <p>AI ë¶„ì„, í¬ì¸íŠ¸ ëˆ„ì , ë­í‚¹, ë ˆë²¨ ë“± ëª¨ë“  ê¸°ëŠ¥ì„ í•œ ë²ˆì— í™•ì¸í•˜ì„¸ìš”!</p>
        </div>

        <!-- ì‚¬ìš©ì ì„ íƒ -->
        <div class="user-selector">
            <label for="user-select">í…ŒìŠ¤íŠ¸í•  ì‚¬ìš©ì ì„ íƒ:</label>
            <select id="user-select">
                <option value="1">ê´€ë¦¬ì (ID: 1)</option>
                <option value="2">ì„¤í˜¸ (ID: 2)</option>
                <option value="3">ê¹€ì§€ìˆ˜ (ID: 3)</option>
                <option value="4">ì´ê°€ì€ (ID: 4)</option>
                <option value="5">ì´í˜¸ìŠ¹ (ID: 5)</option>
                <option value="6">ì•ˆì˜ˆì˜ (ID: 6)</option>
            </select>
        </div>

        <div class="dashboard-grid">
            <!-- ì‚¬ìš©ì ì •ë³´ & ë ˆë²¨ -->
            <div class="card">
                <h2>ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ & ë ˆë²¨</h2>
                <button class="test-button" onclick="loadUserInfo()">ì‚¬ìš©ì ì •ë³´ ë¡œë“œ</button>
                <div id="user-info" class="result-box">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ê³  ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
                
                <div class="level-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="level-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="level-text">ë ˆë²¨ ì •ë³´ë¥¼ ë¡œë“œí•˜ì„¸ìš”</div>
                </div>
            </div>

            <!-- í¬ì¸íŠ¸ í˜„í™© -->
            <div class="card">
                <h2>ğŸ’ í¬ì¸íŠ¸ í˜„í™©</h2>
                <button class="test-button" onclick="loadPointSummary()">í¬ì¸íŠ¸ ìš”ì•½</button>
                <button class="test-button" onclick="loadPointHistory()">í¬ì¸íŠ¸ ë‚´ì—­</button>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="total-points">0</span>
                        <span class="stat-label">ì´ í¬ì¸íŠ¸</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="earned-points">0</span>
                        <span class="stat-label">íšë“ í¬ì¸íŠ¸</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="spent-points">0</span>
                        <span class="stat-label">ì‚¬ìš© í¬ì¸íŠ¸</span>
                    </div>
                </div>
                
                <div class="point-history" id="point-history">
                    <div class="point-item">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¡œë“œí•˜ì„¸ìš”</div>
                </div>
            </div>

            <!-- ë­í‚¹ í˜„í™© -->
            <div class="card">
                <h2>ğŸ† ë­í‚¹ í˜„í™©</h2>
                <button class="test-button" onclick="loadIndividualRanking()">ê°œì¸ ë­í‚¹</button>
                <button class="test-button" onclick="loadCollegeRanking()">ë‹¨ê³¼ëŒ€ ë­í‚¹</button>
                <button class="test-button" onclick="loadUserRanking()">ë‚´ ìˆœìœ„</button>
                
                <div class="ranking-list" id="ranking-list">
                    <div class="ranking-item">
                        <span class="ranking-position">-</span>
                        <span class="ranking-name">ë­í‚¹ì„ ë¡œë“œí•˜ì„¸ìš”</span>
                        <span class="ranking-points">0ì </span>
                    </div>
                </div>
            </div>

            <!-- AI ë¶„ì„ ê²°ê³¼ -->
            <div class="card">
                <h2>ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h2>
                <button class="test-button" onclick="loadAIResults()">AI ë¶„ì„ ê²°ê³¼</button>
                <button class="test-button" onclick="loadUserImages()">ì—…ë¡œë“œ ì´ë¯¸ì§€</button>
                
                <div class="ai-results" id="ai-results">
                    <div class="ai-item">AI ë¶„ì„ ê²°ê³¼ë¥¼ ë¡œë“œí•˜ì„¸ìš”</div>
                </div>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ ì¢…í•© ì •ë³´ -->
            <div class="card">
                <h2>ğŸ“Š ëŒ€ì‹œë³´ë“œ ì¢…í•©</h2>
                <button class="test-button" onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ë¡œë“œ</button>
                <div id="dashboard-info" class="result-box">ëŒ€ì‹œë³´ë“œ ì •ë³´ë¥¼ ë¡œë“œí•˜ì„¸ìš”.</div>
            </div>

            <!-- ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
            <div class="card">
                <h2>ğŸ†• ìƒˆë¡œìš´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
                <button class="test-button" onclick="testUserSearch()">ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ì ê²€ìƒ‰</button>
                <button class="test-button" onclick="testTopRankings()">Top 30 ë­í‚¹ ì¡°íšŒ</button>
                <button class="test-button" onclick="testPointsByType()">íƒ€ì…ë³„ í¬ì¸íŠ¸ ì¡°íšŒ</button>
                <div id="new-features-result" class="result-box">ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <button class="refresh-all" onclick="refreshAll()">ğŸ”„ ì „ì²´ ìƒˆë¡œê³ ì¹¨</button>

    <script>
        const BASE_URL = 'http://43.203.226.243:8080';
        
        // í˜„ì¬ ì„ íƒëœ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
        function getCurrentUserId() {
            return document.getElementById('user-select').value;
        }
        
        // API í˜¸ì¶œ í•¨ìˆ˜
        async function callAPI(endpoint, elementId = null) {
            if (elementId) {
                const element = document.getElementById(elementId);
                element.textContent = 'â³ ë¡œë”© ì¤‘...';
                element.className = 'result-box loading';
            }
            
            try {
                const response = await fetch(BASE_URL + endpoint);
                const data = await response.json();
                
                if (elementId) {
                    const element = document.getElementById(elementId);
                    element.textContent = JSON.stringify(data, null, 2);
                    element.className = response.ok ? 'result-box success' : 'result-box error';
                }
                
                return data;
            } catch (error) {
                if (elementId) {
                    const element = document.getElementById(elementId);
                    element.textContent = `âŒ ì˜¤ë¥˜: ${error.message}`;
                    element.className = 'result-box error';
                }
                throw error;
            }
        }
        
        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        async function loadUserInfo() {
            const userId = getCurrentUserId();
            try {
                const data = await callAPI(`/api/users/${userId}`, 'user-info');
                
                if (data.success && data.data) {
                    const user = data.data;
                    
                    // ë ˆë²¨ ì§„í–‰ë¥  ê³„ì‚° (ì„ì‹œë¡œ í¬ì¸íŠ¸ ê¸°ì¤€)
                    const levelProgress = Math.min((user.pointsTotal % 1000) / 10, 100);
                    document.getElementById('level-progress').style.width = levelProgress + '%';
                    document.getElementById('level-text').textContent = 
                        `ë ˆë²¨ ${user.level} (${user.pointsTotal}ì )`;
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // í¬ì¸íŠ¸ ìš”ì•½ ë¡œë“œ
        async function loadPointSummary() {
            const userId = getCurrentUserId();
            try {
                const userData = await callAPI(`/api/users/${userId}`);
                const pointData = await callAPI(`/api/points/user/${userId}`);
                
                if (userData.success && userData.data) {
                    document.getElementById('total-points').textContent = userData.data.pointsTotal;
                }
                
                if (pointData.success && pointData.data) {
                    let earned = 0, spent = 0;
                    pointData.data.forEach(point => {
                        if (point.points > 0) earned += point.points;
                        else spent += Math.abs(point.points);
                    });
                    
                    document.getElementById('earned-points').textContent = earned;
                    document.getElementById('spent-points').textContent = spent;
                }
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ìš”ì•½ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // í¬ì¸íŠ¸ ë‚´ì—­ ë¡œë“œ
        async function loadPointHistory() {
            const userId = getCurrentUserId();
            try {
                const data = await callAPI(`/api/points/user/${userId}`);
                
                if (data.success && data.data) {
                    const historyHtml = data.data.slice(0, 10).map(point => `
                        <div class="point-item">
                            <span>${point.description || point.type}</span>
                            <span class="${point.points > 0 ? 'point-earned' : 'point-spent'}">
                                ${point.points > 0 ? '+' : ''}${point.points}ì 
                            </span>
                        </div>
                    `).join('');
                    
                    document.getElementById('point-history').innerHTML = historyHtml;
                }
            } catch (error) {
                console.error('í¬ì¸íŠ¸ ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ê°œì¸ ë­í‚¹ ë¡œë“œ
        async function loadIndividualRanking() {
            try {
                const data = await callAPI('/api/rankings/individual/top?scopeType=TOTAL&limit=10');
                displayRanking(data);
            } catch (error) {
                console.error('ê°œì¸ ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë‹¨ê³¼ëŒ€ ë­í‚¹ ë¡œë“œ
        async function loadCollegeRanking() {
            try {
                const data = await callAPI('/api/rankings/college/top?scopeType=TOTAL&limit=10');
                displayRanking(data);
            } catch (error) {
                console.error('ë‹¨ê³¼ëŒ€ ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë‚´ ìˆœìœ„ í™•ì¸
        async function loadUserRanking() {
            const userId = getCurrentUserId();
            try {
                const data = await callAPI(`/api/users/${userId}/rankings`);
                
                if (data.success && data.data) {
                    const rankingHtml = Object.entries(data.data).map(([scope, rank]) => `
                        <div class="ranking-item">
                            <span class="ranking-position">${rank}ìœ„</span>
                            <span class="ranking-name">${scope}</span>
                            <span class="ranking-points">ë‚´ ìˆœìœ„</span>
                        </div>
                    `).join('');
                    
                    document.getElementById('ranking-list').innerHTML = rankingHtml;
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ë­í‚¹ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ë­í‚¹ í‘œì‹œ
        function displayRanking(data) {
            if (data.success && data.data && data.data.rankings) {
                const rankingHtml = data.data.rankings.map((item, index) => `
                    <div class="ranking-item">
                        <span class="ranking-position">${index + 1}ìœ„</span>
                        <span class="ranking-name">${item.name || item.username || `ID: ${item.userId}`}</span>
                        <span class="ranking-points">${item.points}ì </span>
                    </div>
                `).join('');
                
                document.getElementById('ranking-list').innerHTML = rankingHtml;
            }
        }
        
        // AI ë¶„ì„ ê²°ê³¼ ë¡œë“œ
        async function loadAIResults() {
            const userId = getCurrentUserId();
            try {
                const data = await callAPI(`/api/ai/user/${userId}`, 'ai-results');
                
                if (data.success && data.data) {
                    const aiHtml = data.data.slice(0, 5).map(result => `
                        <div class="ai-item">
                            <strong>ë¶„ì„ ê²°ê³¼:</strong> ${result.resultData || 'AI ë¶„ì„ ì™„ë£Œ'}<br>
                            <small>ë¶„ì„ ì‹œê°„: ${new Date(result.createdAt).toLocaleString()}</small>
                        </div>
                    `).join('');
                    
                    document.getElementById('ai-results').innerHTML = aiHtml || '<div class="ai-item">AI ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('AI ê²°ê³¼ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ì—…ë¡œë“œ ì´ë¯¸ì§€ ë¡œë“œ
        async function loadUserImages() {
            const userId = getCurrentUserId();
            await callAPI(`/api/ai/images/user/${userId}`, 'ai-results');
        }
        
        // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        async function loadDashboard() {
            const userId = getCurrentUserId();
            await callAPI(`/api/main/dashboard/${userId}`, 'dashboard-info');
        }
        
        // ì‚¬ìš©ì ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        async function testUserSearch() {
            await callAPI('/api/users/search?name=ì„¤í˜¸', 'new-features-result');
        }
        
        // Top ë­í‚¹ í…ŒìŠ¤íŠ¸
        async function testTopRankings() {
            await callAPI('/api/rankings/individual/top?scopeType=TOTAL&limit=30', 'new-features-result');
        }
        
        // íƒ€ì…ë³„ í¬ì¸íŠ¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸
        async function testPointsByType() {
            const userId = getCurrentUserId();
            await callAPI(`/api/points/user/${userId}/type/EARNED`, 'new-features-result');
        }
        
        // ì „ì²´ ìƒˆë¡œê³ ì¹¨
        async function refreshAll() {
            await loadUserInfo();
            await loadPointSummary();
            await loadPointHistory();
            await loadIndividualRanking();
            await loadAIResults();
            await loadDashboard();
        }
        
        // ì‚¬ìš©ì ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
        document.getElementById('user-select').addEventListener('change', refreshAll);
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            // ì´ˆê¸° ë¡œë“œëŠ” ì‚¬ìš©ìê°€ ì„ íƒ í›„ ìˆ˜ë™ìœ¼ë¡œ í•˜ë„ë¡ í•¨
        });
    </script>
</body>
</html>
