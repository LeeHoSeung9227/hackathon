<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë“œ ë¹„êµ - ìˆ˜ì • ì „ vs ìˆ˜ì • í›„</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .code-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .code-section h2 {
            margin-top: 0;
            padding: 15px;
            border-radius: 8px;
            color: white;
            text-align: center;
        }
        .before h2 {
            background: #dc3545;
        }
        .after h2 {
            background: #28a745;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.6;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        .added {
            background: #d4edda;
            color: #155724;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        .removed {
            background: #f8d7da;
            color: #721c24;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        .summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .summary h3 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .change-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .change-item strong {
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ì½”ë“œ ë¹„êµ: ìˆ˜ì • ì „ vs ìˆ˜ì • í›„</h1>
        
        <div class="comparison">
            <div class="code-section before">
                <h2>âŒ ìˆ˜ì • ì „ (ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ)</h2>
                <div class="code-block">
// src/api/tacoApi.ts (ìˆ˜ì • ì „)
import apiClient from "./apiClient";
import axios from "axios";

export async function analyzeImage(file: File): Promise<string> {
  try {
    const formData = new FormData();
    formData.append("image", file);

    const response = await apiClient.post("api/ai/analyze", formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });

    return response.data;
  } catch (error: any) {
    if (axios.isAxiosError(error)) {
      if (error.response) {
        throw new Error(error.response.data);
      }
      throw new Error(error.message);
    }
    throw error;
  }
}

// src/api/apiClient.ts
import axios from "axios";

// ê°œë°œ ë‹¨ê³„ìš© ê³ ì • í† í° (ë‚˜ì¤‘ì—” ë¡œê·¸ì¸ ì¸ì¦ ê²°ê³¼ë¡œ ëŒ€ì²´)
const ACCESS_TOKEN = "cc25e466-fc6c-4d24-8a63-6f3cba41cbd0";

// ê³µí†µ axios ì¸ìŠ¤í„´ìŠ¤
const apiClient = axios.create({
  baseURL: "http://43.203.226.243:8080", // ì‹¤ì œ ì„œë²„ ì£¼ì†Œ ì‘ì„±
  headers: {
    Authorization: `Bearer ${ACCESS_TOKEN}`,
  },
});

export default apiClient;

// ì‚¬ì§„ ì´¬ì˜ ë° ë°±ì—”ë“œ ì „ì†¡
const capturePhoto = async () => {
  if (!videoRef.current || !canvasRef.current) return;

  setIsLoading(true);

  try {
    const canvas = canvasRef.current;
    const video = videoRef.current;
    const context = canvas.getContext('2d');
    if (!context) return;

    // ë¹„ë””ì˜¤ í”„ë ˆì„ì„ ìº”ë²„ìŠ¤ì— ê·¸ë¦¼
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);

    // ìº”ë²„ìŠ¤ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ í›„ API í˜¸ì¶œ
    canvas.toBlob(async (blob) => {
      if (!blob) {
        setIsLoading(false);
        alert("ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨");
        return;
      }

      try {
        const file = new File([blob], 'capture.jpg', { type: 'image/jpeg' });
        const result = await analyzeImage(file);  // â† ì´ ì¤„ì„ ìˆ˜ì •
        // ëª¨ë¸ ë¶„ì„ ê²°ê³¼ë¥¼ result ë³€ìˆ˜ì— ë°›ìŒ

        // ì„±ê³µ ì‹œ resultë¥¼ í™”ë©´ì— ì¶œë ¥í•˜ê±°ë‚˜ ì²˜ë¦¬ (ì˜ˆì œ: alert)
        alert("ë¶„ì„ ê²°ê³¼:\n" + result);

        // í•„ìš” ì‹œ ë‹¤ë¥¸ í˜ì´ì§€ ì´ë™ ë“± ì²˜ë¦¬ ê°€ëŠ¥
        // navigate('/Success'); í˜¹ì€ setResult(result) ë“±

      } catch (error: any) {
        alert("ë¶„ì„ ì‹¤íŒ¨: " + error.message);
      } finally {
        setIsLoading(false);
      }
    }, 'image/jpeg', 0.8);

  } catch (error) {
    setIsLoading(false);
    alert("ì‚¬ì§„ ì´¬ì˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }
};
                </div>
            </div>
            
            <div class="code-section after">
                <h2>âœ… ìˆ˜ì • í›„ (í•´ê²°ëœ ì½”ë“œ)</h2>
                <div class="code-block">
// src/api/tacoApi.ts (ìˆ˜ì • í›„)
import apiClient from "./apiClient";
import axios from "axios";

export async function analyzeImage(file: File, userId: string): Promise<string> {
  try {
    const formData = new FormData();
    formData.append("image", file);
    formData.append("userId", userId);  // âœ… userId ì¶”ê°€

    const response = await apiClient.post("api/ai/analyze", formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });

    return response.data;
  } catch (error: any) {
    if (axios.isAxiosError(error)) {
      if (error.response) {
        throw new Error(error.response.data);
      }
      throw new Error(error.message);
    }
    throw error;
  }
}

// src/api/apiClient.ts
import axios from "axios";

// ê°œë°œ ë‹¨ê³„ìš© ê³ ì • í† í° (ë‚˜ì¤‘ì—” ë¡œê·¸ì¸ ì¸ì¦ ê²°ê³¼ë¡œ ëŒ€ì²´)
const ACCESS_TOKEN = "cc25e466-fc6c-4d24-8a63-6f3cba41cbd0";

// ê³µí†µ axios ì¸ìŠ¤í„´ìŠ¤
const apiClient = axios.create({
  baseURL: "http://43.203.226.243:8080", // ì‹¤ì œ ì„œë²„ ì£¼ì†Œ ì‘ì„±
  headers: {
    Authorization: `Bearer ${ACCESS_TOKEN}`,
  },
});

export default apiClient;

// ì‚¬ì§„ ì´¬ì˜ ë° ë°±ì—”ë“œ ì „ì†¡
const capturePhoto = async () => {
  if (!videoRef.current || !canvasRef.current) return;

  setIsLoading(true);

  try {
    const canvas = canvasRef.current;
    const video = videoRef.current;
    const context = canvas.getContext('2d');
    if (!context) return;

    // ë¹„ë””ì˜¤ í”„ë ˆì„ì„ ìº”ë²„ìŠ¤ì— ê·¸ë¦¼
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);

    // ìº”ë²„ìŠ¤ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ í›„ API í˜¸ì¶œ
    canvas.toBlob(async (blob) => {
      if (!blob) {
        setIsLoading(false);
        alert("ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨");
        return;
      }

      try {
        const file = new File([blob], 'capture.jpg', { type: 'image/jpeg' });
        const result = await analyzeImage(file, "ì‚¬ìš©ìID");  // âœ… userId ì¶”ê°€
        // ëª¨ë¸ ë¶„ì„ ê²°ê³¼ë¥¼ result ë³€ìˆ˜ì— ë°›ìŒ

        // ì„±ê³µ ì‹œ resultë¥¼ í™”ë©´ì— ì¶œë ¥í•˜ê±°ë‚˜ ì²˜ë¦¬ (ì˜ˆì œ: alert)
        alert("ë¶„ì„ ê²°ê³¼:\n" + result);

        // í•„ìš” ì‹œ ë‹¤ë¥¸ í˜ì´ì§€ ì´ë™ ë“± ì²˜ë¦¬ ê°€ëŠ¥
        // navigate('/Success'); í˜¹ì€ setResult(result) ë“±

      } catch (error: any) {
        alert("ë¶„ì„ ì‹¤íŒ¨: " + error.message);
      } finally {
        setIsLoading(false);
      }
    }, 'image/jpeg', 0.8);

  } catch (error) {
    setIsLoading(false);
    alert("ì‚¬ì§„ ì´¬ì˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }
};
                </div>
            </div>
        </div>
        
        <div class="summary">
            <h3>ğŸ“‹ ì£¼ìš” ë³€ê²½ì‚¬í•­ ìš”ì•½</h3>
            
            <div class="change-item">
                <strong>1. í•¨ìˆ˜ íŒŒë¼ë¯¸í„° ì¶”ê°€</strong><br>
                <span class="removed">ìˆ˜ì • ì „:</span> <code>analyzeImage(file: File)</code><br>
                <span class="added">ìˆ˜ì • í›„:</span> <code>analyzeImage(file: File, userId: string)</code>
            </div>
            
            <div class="change-item">
                <strong>2. FormDataì— userId í¬í•¨</strong><br>
                <span class="removed">ìˆ˜ì • ì „:</span> <code>formData.append("image", file);</code><br>
                <span class="added">ìˆ˜ì • í›„:</span> <code>formData.append("image", file); formData.append("userId", userId);</code>
            </div>
            
            <div class="change-item">
                <strong>3. í•¨ìˆ˜ í˜¸ì¶œ ì‹œ userId ì „ë‹¬</strong><br>
                <span class="removed">ìˆ˜ì • ì „:</span> <code>analyzeImage(file)</code><br>
                <span class="added">ìˆ˜ì • í›„:</span> <code>analyzeImage(file, "ì‚¬ìš©ìID")</code>
            </div>
            
            <div class="change-item">
                <strong>ğŸ¯ ê²°ê³¼:</strong> ë°±ì—”ë“œì—ì„œ ìš”êµ¬í•˜ëŠ” <code>userId</code> íŒŒë¼ë¯¸í„°ê°€ í¬í•¨ë˜ì–´ 500 ì˜¤ë¥˜ê°€ í•´ê²°ë©ë‹ˆë‹¤!
            </div>
        </div>
    </div>
</body>
</html>
